
Wireless Security Protocols available:

 - Open
 - WEP  (Wired Equivalent Protocol)
 - WPA  (Wi-Fi Protected Access)
 - WPA2 (Wi-Fi Protected Access II)

Por su uso extendido nos centraremos en: WPA y WPA2

########################
## Cracking WPA ########
########################

       --------------------------------------------------------------------------------------------------------------------------------------------------------------
       | 1 | Breve descripción																	    |
       --------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	WPA is an implementation of the IEEE 802.11i standard. Temporal Key Integrity Protocol (TKIP) was introduced in WPA to overcome the drawbacks in WEP.
	
	Hay dos tipos de WPA:
	
	  - WPA Personal
	  - WPA Enterprise

                     
	############################
        ## A) WPA Personal #########
        ############################
	
	WPA Personal, also called "WPA Pre Shared Key (PSK)", is the most common authentication method used on wireless networks today. It is the standard for residential 
	implementations and SMBs have also found it easy to implement.

	Residential and small business tend to use WPA PSK, in part because of the administrative overhead of "WPA Enterprise". Whereas "WPA PSK" uses a single shared key 
	for authentication, TKIP is used to generate unique encryption keys whenever a client connects to the network. These per-session keys increase the security of the 
	communication between the wireless client and the access point. In a typical "WPA PSK" setup, wireless administrators configure the "WPA PSK" key on each of the APs 
	or on the controller and then distribute the key to employees in their organization. The key will remain the same for all the employees; there are some advantages 
	and disadvantages in using this kind of solution.
	
	Password Length: The minimum password length of the WPA PSK key is eight ASCII characters.
	
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------
        | A-1 | Steps involved in the authentication method														  |
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	   1) - Each user is given a password to authenticate to the network; those who have this password can access the network. 
	      - This password is also called "Pre-shared
	        master key (PMK)", is the same for all users.
	      
	   2) - By using this PMK a transiente/temporal key is generated between the client and AP (Access Point) for every new session. 
	      - Pairwise Transient/Temporal Keys (PTK) are used to ENCRYPT the data and the "key" is valid until the session ends.

        -------------------------------------------------------------------------------------------------------------------------------------------------------------------
        | A-2 | Risks																			  |
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------
	 
	  - Even if the attacker has knowledge of the PMK used in the network, he cannot decrypt the packets without calculating the temporal key (PTK).
	  - To determine the PTK, the attacker will also need to capture the "handshake" between the wireless client and the AP during the initiation of a new session.
	  - The PSK is vulnerable to dictionary attack. The captured traffic should also contain "four-way hanshake packets".
	  
	  
	-------------------------------------------------------------------------------------------------------------------------------------------------------------------
        | A-3 | Example																			  |
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------

	    1) Bring the card up and create a "monitor mode interface" on the wireless card:
	
	       >ifconfig wlan0 up
	       >airmon-ng start wlan0
	       
	    2) Make sure the WLAN interface is up and running. Once confirmed, start airmon-ng to create a monitor mode interface by using the following command:

               >airmon-ng start wlan0
	 
	    3) Once you have created the "monitor mode interface", scan the air for available wireless networks by using "airodump-ng". airodump-ng will scan all the 14
	       channels in 2.4 Ghz frequency and show the list of wireless access points in range.

	       >airodump-ng mon0

	    4) Capture the "four-way-handshake": 
	    
	       To increase the likelihood that you are able to capture the data that you are looking for, it is recommended that you identify the channel that the AP is 
	       communicating on and limit your radio to listen on that channel. The following command has been constructed to specify the name of the file to save the 
	       capture, channel to sniff, and finally the interface to use, which should be a monitor mode interface:
	       
	       >airodump-ng -w labfiles/wpacrack/wpa-Seclab -c 9 mon0
	       
	          -c:  Specifies the channel to sniff.
	          -w:  Specifies the file to save the captured data.
	          
	    5) Capture the "four-way-handshake" (Cont.):
	     
	       Once a client connects to the wireless network, airodump-ng is looking to capture the "four-way handshake". After the capture of this handshake is complete, 
	       we are able to see this indicated in the airodump-ng output at the top-right corner, as seen in the following screenshot.
	        
	     
	    6) After capturing the "four-way handshake", it is now time to crack the key using a wordlist. Kali Linux contains a default wordlist. Use "aircrack-ng" to crack 
	       the key using that dictionary:
	       
	       >aircrack-ng labfiles/wpacrack/wpa-Seclab-01.cap –w /usr/share/wordlists/rockyou.txt


########################
## Cracking WPA2 #######
########################

       --------------------------------------------------------------------------------------------------------------------------------------------------------------
       | 1 | Breve descripción																	    |
       --------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	WPA2 (Wi-Fi Protected Access II) is a full implementation of the IEEE 802.11i standard. As with WPA, it is available in two flavors:
	
	  - WPA2 Personal   ==> WPA2 PSK uses a passphrase as a method of authentication
	  - WPA2 Enterprise ==> Uses RADIUS server to authenticate users

        WPA2 uses the AES (Advanced Encryption Standard) encryption protocol (WPA2-AES); stronger than both WPA and WEP protocols.
       
	############################
        ## A) WPA Personal #########
        ############################
	
	Even with the increased encryption available with WPA2-PSK (con AES como mecanismo de cifrado), it is still vulnerable to "dictionary attack".
	
	El ataque tendra 2 fases:
	
	   A) Captura del tráfico: airodump-ng
	   B) Cracking: aircrack-ng
	   
	-------------------------------------------------------------------------------------------------------------------------------------------------------------------
        | A-1 | Example																			  |
        -------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	  1) To prepare the wireless card for capturing the wireless traffic, put the card in "monitor mode":
	  
	      1-1) Bring the card up and create the monitor mode interface:
	      
	           >ifconfig wlan0 up
	           
	      1-2) Create a monitor mode interface:
	      
	           >airmon-ng start wlan0

	  2) Capture the "four-way-handshake" when any wireless client (laptops or mobile devices) connect to the wireless network. You will need to wait for some time to 
	     accomplish this task.

	       >airodump-ng mon0
	       
	     Si queremos darle mas detalles acerca de una red y canales concretos:
	     
	       >airodump-ng mon0 -c 9 -w labfiles/wpacrack/wpa2-Seclab
	     
	     As with WPA-PSK, a couple of activities will allow you to capture the handshake:
	
		2-1) Wait until a legitimate client connects to the network
		2-2) Forcibly disconnect any wireless client that is already connected to the network and watch as the client tries to connect again with the network
		
	  3) Sniff the channel on which the AP is communicating to capture wireless traffic. This wireless traffic is used to "crack the WPA2 PSK password".
	     
	     "aircrack-ng" tool is used which takes 2 parameters:
	     
	         a) wireless traffic "pcap" file ==> it MUST contains a valid "handshake packet"
	         b) wordlist ==> importantisimo disponer de un buen wordlist.

	      
	      >aircrack-ng labfiles/wpacrack/wpa2-Seclab-01.cap -w /usr/share/wordlists/rockyou.txt
	
 

####################################
## Generating Rainbow Tables #######
####################################

During the process of cracking WPA/WPA2 PSK, a PMK (Pairwise Master Key) is derived from ESSID and the password, which is then used to calculate PTK (Pairwise Transient Key); this is
again used to calculate the MIC (Message Integrity Code) value for the initial handshake process.

If the generated MIC equals the MIC in the original hanshake, then we can infer that the password used to generate the PMK is te correct password used on the network.

PMK is never shared over the network, it is calculated using the passphrase configured on the client.

To generate the PMK by using the passphrase, the following formula is used:

   PMK = PBKDF2(PassPhrase, SSID, SSIDLength, 4096, 256)
   
        - PBKDF2 algorithm is used to generate the PMK, taking the SSID and passphrase as input.
        
        
    ########################
    ## Example #############
    ########################

    To generate rainbow tables, we require the target network SSID and wordlist.
    
	1) Use the following command to generate a rainbow table for the SSID "Seclab" by using the default wordlist available in Kali Linux:
	
	   >genpmk -f /usr/share/wordlists/rockyou.txt -d /root/labfiles/wpacrack/genpmk-hash-Seclab2 -s Seclab
	   
		 -f: Specifies the wordlist/dictionary (rockyou.txt)
		 -d: Specifies the database filename to be created
		 -s: Specifies the SSID
	
	2) Once the rainbow tables are ready, you can use it in the "cracking process" to decrease the time required to crack the key.
	   We will use the generated rainbow table along with an application called "coWPAtty" to crack the WPA/WPA2 key.
	   
	   To crack the key with the help of rainbow tables, run the following command:
	   
	     >cowpatty -d labfiles/wpacrack/genpmk-hash-Seclab -r labfiles/wpacrack/ilovehate-01.cap -s Seclab
	     
	        -d: Specifies the rainbow table to use
	        -r: Specifies the capture file containing the "four-way-handshake"
	        -s: Specifies the SSID

#####################################################
## Generating Rainbow Tables with "airolib-ng #######
#####################################################

To generate rainbow tables using airolib-ng, you need to know the target network SSID and have a good dictionary file. 



########################
## Cracking WPS ########
########################

       --------------------------------------------------------------------------------------------------------------------------------------------------------------
       | 1 | Breve descripción																	    |
       --------------------------------------------------------------------------------------------------------------------------------------------------------------

	Wi-Fi Protected Setup (WPS) is a wireless security protocol designed to allow users to simply secure wireless networks and reduce the complexity of adding 
	new hosts. 

	The on boarding process leverage a PIN, which is either obtained from the APs configuration interface, or may also be printed on a tabled affixed to the AP.
	It may also be associated with a button press that enables the device to begin the onboarding process.

       --------------------------------------------------------------------------------------------------------------------------------------------------------------
       | 2 | Vulnerabilidad																	    |
       --------------------------------------------------------------------------------------------------------------------------------------------------------------

	WPS PIN feature is vulnerable to a brute force attack where an attacker is able to recover the WPA/WPA2 key on the device.
	This attack is not possible on all AP; it can be a successful means of attack on most AP and Routers with old firmware.

       --------------------------------------------------------------------------------------------------------------------------------------------------------------
       | 2 | Cracking																	    |
       --------------------------------------------------------------------------------------------------------------------------------------------------------------

	In order to crack WPS PIN we will use the "reaver" tool.
	
	  1) Bring the wireless card up and create a "monitor mode" interface on the wireless card:
	  
	     >ifconfig wlan0 up
	     >airmon-ng start wlan0
	     
	  2) Reaver: a tool designed exclusively to brute force the WPS PIN authentication. If it is able to discover the PIN, it then proceeds to display the WPA/WPA2 PSK 
	             password on the router to the attacker automatically.
	             
	  3) Scan the air for available wireless networks using the "monitor mode interface".
	  
	     >airodump-ng mon0
	   
	  4) Our challenge is to use Reaver to brute force the WPS PIN and retrieve the WPA/WPA2 PSK key that is preconfigured on the device. Now we run Reaver against the
	     AP by using the following command:
	     
	     >reaver -i mon0 -b xx:xx:xx:xx:xx:xx -c 10 -vv
	     
	         -i:  Specifies the interface to use
	         -b:  The MAC address of the wireless AP
	         -c;  The channel to listen
	         -vv: Verbatim mode, which displays additional information about what is happening.
	  
	  

#########################################
## Cracking 802.1x using hostpan ########
#########################################


